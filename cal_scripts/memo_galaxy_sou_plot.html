<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta content="text/html; charset=ISO-8859-1"
 http-equiv="content-type">
  <title>memo_cal.html</title>
  <meta content="Daniel Wang" name="author">
</head>
<body>
<pre>;Plot X-ray sources detected with Chandra data on galaxies<br>;=============================================================================<br>; This is more advanced analysis than in memo_anal and is specifically for <br>; nearby galaxy studies.<br>;<br>; Each galaxy is different. Of course, an observation itself could be <br>; unique. Therefore, the analysis needs to be adjusted accordingly.<br>; Various comments are included for references. Those ended with !!!, in <br>; particular, most likely need to be adjusted, accordingly.<br>; Most importantly, you need to know what you want. What presented here is <br>; only for your reference. You should make whatever necessary to achieve your<br>; goal.<br>;<br>; written by wqd, May 29, 2003<br>;=============================================================================<br>; Part 1: plotting sources <br>;=============================================================================<br>instr='aciss'<br>;instr='acisi'<br>cenvset,instr<br><br>trans_radian,12,36,20.781,25,59,15.64,cra,cdec,/deg<br>gradec=[cra,cdec] ;galaxy center - change accordingly!!!<br><br>block=4 &amp; mdim=[1,1]*512 &amp; ccdid=[6,7,8] ;for aciss; centered on the axis if gradec is not defined<br>;block=2 &amp; mdim=[1,1]*512 &amp; ccdid=[6,7,8] &amp; gradec=[140.510975d,50.976519] ;for a close-up<br>;Change accordingly if for example, only chip 7 &lt;is used: ccdid=[7]<br><br>;block=6 &amp; mdim=[1,1]*512  &amp; ccdid=[0,1,2,3] ;for acisi<br>;define a coversion factor to get the intensity in units of 10^2 cts/s/arcmin^2<br>trans=(60./(block*!size_pixel))^2*1.e2 <br><br>evtroot='evt2file_new_clean' ;default file name root<br>evt_image,evtroot,instr,ca,ta,ba=ba,lhdr=lhdr,datadir='../xdata/',gradec=gradec,hdr=mh,xmin=xmin,ymin=ymin,list=l,imdim=mdim,/nofits,imb=block ;,bfname='../back/bevt2file_new_clean_ccd'+strtrim(ccdid,2)+'.fits'<br><br>;construct a Gaussian smoothed count image:<br>;g2=psf_gaussian(fwhm=2,/norm,npix=121)<br>;cc=convolve(total(ca,3),g2) ;for count image only<br>f=imdiv(ca-ba,ta)<br>clo=0 &amp; chi=1<br>cc=convolve(total(f(*,*,clo:chi),3),psf_gaussian(fwhm=2,/norm,npix=121))*trans<br>tv,bscale(cc,0,2)<br><br>;probably need to adjust the image size to remove too much empty space<br>;curval,cc	;to find lower right cornor coordinates of the desirable image<br>cdim=[100,0]<br>cc=cc(cdim(0):mdim(0)-1-cdim(0),cdim(1):mdim(1)-1-cdim(1))<br>get_fitshead,cc,msh,mh,cdim=cdim <br><br>;plot areas to be removed for diffuse X-ray study<br>soufile='../sou/evt2file_new_clean_map70BSH_hr'<br>crval=sxpar(lhdr,'crval*') ;the RA and Dec of the observation aiming center<br>;---------<br>;generating ps file:<br>set_plot,'ps'<br>device,bits=8,color=1,xsize=16.,ysiz=16.*(mdim(1)-2.*cdim(1))/(mdim(0)-2*cdim(0)),yoff=0,xoff=2 ;,/land<br>loadct_self,30<br>;---------------<br>cor=[0.01,0.99,0.01,0.99] <br><br>cont_grey,cc,msh,cor=cor,barf=0.,greymin=0.2,greymax=20,mr=0,/noc,/ps,f_c=!d.n_colors-1,thick=2,/def,greyl=2 ;,/noti<br><br>;plot an ellipse to illustrate the target and select the pixels included:<br>pa=136. &amp; d25=14.9 ;galaxy inclination and position angles and D25<br>el=1-2./d25<br>;if only major and minor axis info is available, use el=1.-minor/major<br>plot_shape,[d25/2.,el,pa],cor,msh,gradec,color=!d.n_colors-1,nsh=2 ;,sel=s<br><br>plot_shape,[1],cor,msh,gradec,color=!d.n_colors-1,nsh=0,sel=s,/noplot<br>;remove the sources included in the ellipse to avoid the overplotting<br>;sou_rsel,msh,rslist,inf=soufile,rpsel=s,image=cc,/rem ;,/ploton<br>;source_plot,soufile,cor,msh,slow=0,probth=probth,psym=6,/fits,s_c=!d.n_colors-1,slist=slist,sym=1<br>plot_reg,cor,msh,soufile+'.reg',crval=crval<br>;plot regions for diffuse X-ray spectral studies (on-galaxy and off-galaxy)<br>plot_reg,cor,msh,'../spec/disk.reg',crval=crval,lines=2<br>plot_reg,cor,msh,'../spec/bulge.reg',crval=crval,lines=2<br>plot_reg,cor,msh,'../spec/halo.reg',crval=crval,lines=2<br>plot_reg,cor,msh,'../spec/sw.reg',crval=crval,lines=2<br>;defind a #7 chip boundary in ds9 and save it into the region file chip.reg<br>plot_reg,cor,msh,'../spec/chip.reg',crval=crval,lines=3<br><br>source_plot,'',cor,msh,slow=0,probth=probth,psym=6.,sym=1,/fits,/sou_no,sra=rslist.ra,sdec=rslist.dec,sn=rslist.sn,s_c=!d.n_colors-1,nssh=rslist.sn,xsh=-1.5*rslist.sradius,ysh=-1*rslist.sradius<br>;scale='1''<br>;scale_plot,cor,msh,0.08,0.03,1,scale,thick=2,char=1.3,color=!d.n_colors-1<br>device,/close<br>$gv idl.ps<br>;==========================================================================<br>;plot sources in the crowded region (e.g., the galactic disk):<br>block=1 &amp; mdim=[1,1]*300 &amp; ccdid=[7] ;for aciss<br>evtroot='evt2file_new_clean' ;default file name root<br>;gradec=[167.879042d,55.674111] ;galaxy center, which should be the same as above<br>soufile='../sou/evt2file_new_clean_map70BSH_hr'<br>trans=(60./(block*!size_pixel))^2*1.e2 ;just a conversion factor<br>evt_image,evtroot,instr,ca,ta,ba=ba,tb=tb,datadir='../xdata/',hdr=mh,xmin=xmin,ymin=ymin,bmin=bmin,bmax=bmax,list=l,imdim=mdim,/nofits,imb=block,gradec=gradec<br>;,bfname='../back/bevt2file_new_clean_ccd'+strtrim(ccdid,2)+'.fits'<br>;construct a Gaussian smoothed count image (adjust the fwhm accordingly!!!):<br>;cc=convolve(total(ca,3),) ;for count image only<br>f=imdiv(ca-ba,ta)<br>clo=0 &amp; chi=3<br>cc=convolve(total(f(*,*,clo:chi),3),psf_gaussian(fwhm=1,/norm,npix=121))*trans<br>tv,bscale(cc,0,2) ;adjust fwhm accordingly to get the best result!!!<br><br>cdim=[1,1]*20 ;any edge of the image to cut?!!!<br>cc=cc(cdim(0):mdim(0)-1-cdim(0),cdim(1):mdim(1)-1-cdim(1))<br>get_fitshead,cc,msh,mh,cdim=cdim <br>;---------<br>;generating ps file:<br>set_plot,'ps'<br>device,bits=8,/land,color=1,xsize=16.,ysize=16.*(mdim(1)-2.*cdim(1))/(mdim(0)-2.*cdim(0)),yoff=26,xoff=2 ;change xsize according to the roll angle!!!<br>loadct_self,30<br>;---------------<br>lev=[3,6,12,25,100,400,1000]*1 ;adjust to get the best result!!!<br>cor=[0.14,0.98,0.1,0.99]<br>;cont_grey,cc,msh,cor=cor,barf=0.,greymin=0.4,greymax=20,greyl=2,mr=0,/noim,f_c=!d.n_colors-1,thick=2,lev=lev ;,yunit=0.2,xunit=0.12,nticky=7 ;,/noti,/def<br><br>cont_grey,cc,msh,cor=cor,barf=0.,greymin=1,greymax=max(cc),greyl=1,mr=0,f_c=!d.n_colors-1,thick=2,/noc,/def,/ps<br>plot_reg,cor,msh,soufile+'.reg',crval=crval<br>;source_plot,soufile,cor,msh,slow=0,probth=probth,/fits,s_c=!d.n_colors-1,slist=slist,sym=1,psym=7<br><br>;scale='10"'<br>;scale_plot,cor,msh,0.04,0.03,1/6.,scale,thick=2,char=1.3,color=!d.n_colors-1<br>source_plot,soufile,cor,msh,slow=0,probth=probth,psym=6.,/fits,/sou_no,s_c=!d.n_colors-1,sym=0.7 ;,nssh=[6,36,38,39,52],xsh=[-7,0,-15,-18,0],ysh=[0,5,5,-8,4]<br>plot_ell,el,pa,d25/2.,cor,msh,gradec,color=!d.n_colors-1,/deg<br><br>device,/close<br>$gv idl.ps<br>set_plot,'x'<br><br>;============================================================<br>; Part 2: Comparison with other images (to find counterparts of sources)<br>;============================================================<br>to be constructed<br></pre>
</body>
</html>
