<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta content="text/html; charset=ISO-8859-1"
 http-equiv="content-type">
  <title>memo_cal.html</title>
  <meta content="Daniel Wang" name="author">
</head>
<body>
<pre>##########################################################################<br># 	Memo for Chandra ACIS observation calibration<br>#<br>#  You can run the unix cammands and scripts, using copy and paste.<br>#  It helps to understand the scipts (*.e), at least the information in the headers.<br>#<br>#  After a successful run, you can move on to read the file "memo_anal" about<br>#  post-calibration analysis (e.g., source detection and image construction).<br>#<br># Requirements:<br># 1) The environment variable PUBDIR needs to be defined (ideally in your <br>#   .cshrc); e.g., setenv PUBDIR /net/xray/pub, which is where you have <br>#    installed cal_scripts directory.<br># 2) ciaoinit.e should have been run (e.g., type<br># 	source $PUBDIR/cal_scripts/ciaoinit.e and then type ciao)<br># 3) Standard archival files have been downloaded and untared in the so-called <br># 	main directory (e.g., n4631)<br># 4) Make a directory called cal (mkdir cal) in the main directory<br>#	and move into it (cd cal)<br># 5) For cleaning high background intervals of the observation without <br>#  potential effects due to source variability, a bright source regional <br>#  file (source.reg) is then needed in the  ciao format and saved<br>#	 in the current directory (e.g., usign ds9). If the file is not <br>#	provided, no region is removed. The cleaning uses a non-ciao package<br>#	acisbg from Markavich (lc_clean), which is assumed to be installed in <br>#	$LOCALDIR<br>#<br># Key decisions need to be made (see the following):<br>#  1) processing choice:<br>#	evt1 - from evt1 to evt2 (def for VF mode)<br>#	evt2: just modify evt2<br>#  3) VF mode flag: yes - to reduce the background in the timed VF mode <br>#	(good for diffuse study. However, a significant fraction of the <br>#	source events may be flagged and removed for moderately bright to <br>#	bright sources. <br>#	no - no flag, which may be good for studying discrete sources<br>#     In principle, two versions of the process may be produced for the VF mode<br>#<br># written by wqd, July, 2002<br># updated by wqd, Jan 5, 2003: 1) several shell variables are converted <br># 	into environment valiables to simplify the entries to scripts<br>#	2) multiple file processing scripts are added.<br># updated by wqd, May 31, 2007<br>##########################################################################<br>#To turn on the creation of count and flux maps by make_expmap.e, <br># setenv CMAP 1<br>setenv CMAP 0<br><br>#as May, 2007,  the CTI corrected background data are still not available for BI chips<br>#setenv APPLYCTI yes<br>setenv APPLYCTI no<br><br>#set the default root name for processed files:<br>set event_root=evt2file<br><br>#making the right choice of the instrument:<br>setenv INSTR aciss<br>#setenv INSTR acisi<br>#special for the GC observations and others with high absorption:<br>#setenv INSTR acisi_low<br>#-----------------------------------------------------<br>#From the main dir, check to see if there are multiple OBIs:<br>ls ./*/acis*evt1.fits*<br><br>#If yes, the processing needs to be done separately for each OBI, see<br># http://cxc.harvard.edu/ciao/dictionary/obi.html<br>#If there more than 1 entries, the observing time should match the right asol <br>#file. It is advised to processed them in different directories (e.g., <br>#1561_0 and 1561_1); <br>#-----------------------------------------------------<br>#move to the processing directory<br>cd cal<br>#main directory (containing primary etc) relative to this processing direction<br>setenv MAINDIR ..<br><br>#uppack the necessary files:<br>find $MAINDIR -name 'acis*evt2.fits.gz' -exec gunzip {} \;<br><br>find $MAINDIR -name 'acis*bpix1.fits.gz' -exec gunzip {} \;<br>find $MAINDIR -name 'pcadf*_asol1.fits.gz' -exec gunzip {} \;<br><br>#make soft links to default file names:<br>find $MAINDIR -name 'acis*evt2.fits' -exec ln -s {} ${event_root}.fits \;<br><br>find $MAINDIR -name 'acis*bpix1.fits' -exec ln -s {} bpixfile.fits \;<br>;new file required for dead area correction introduced in CIAO 4.0?<br>find $MAINDIR -name 'acis*pbk*.fits.gz' -exec ln -s {} pbkfile.fits \;<br>rm asol_file<br>find $MAINDIR -name 'pcadf*_asol1.fits' -exec sh -c 'ls {} &gt;&gt; asol_file' \;<br><br>#check that the links are correct:<br>ls -ltr bpixfile.fits ${event_root}.fits<br>more asol_file<br>#--------------------------------------------------------------------<br>#The third reprocessing of Chandra data (REPRO-III) was started in February 2006<span
 style="font-weight: bold;">; </span>Almost all of the observations <br># should have been reprocessed. But to make sure, check<b><b> the keyword "date" in the fits header.<br></b></b>
</pre>
<p> </p>
#The standard pipeline does not&nbsp; check very faint mode. If the
observation is done in this mode and the reduction of the background is
desirable, evt2 needs to be re-created by running acis_process_events:<br>
#check to see if the observation was taken in timed vfaint mode<br>
dmkeypar ${event_root}.fits DATAMODE ; pget dmkeypar value<br>
dmkeypar ${event_root}.fits READMODE ; pget dmkeypar value<br>
#if it was, you MAY want to use CHVF=yes <br>
setenv CHVF yes<br>
#setenv CHVF no
<pre><br></pre>
<pre>find $MAINDIR -name '*flt*.fits.gz' -exec gunzip {} \;<br>find $MAINDIR -name 'acis*flt*' -exec ln -s {} fltfile.fits \;<br><br>find $MAINDIR -name '*evt1*.fits.gz' -exec gunzip {} \;<br>find $MAINDIR -name '*evt1*' -exec ln -s {} evt1file.fits \;<br><br>#check that the files are actually there and are correct:<br>ls -ltr fltfile.fits evt1file.fits<br>ln -s evt1file.fits aspcorr_evt2.fits<br>$PUBDIR/cal_scripts/evt1to2.e ${event_root}<br><br>#Check the size of the output event file:<br>ls -ltr ${event_root}_new.fits<br>#--------------------------------------------------------------------<br>#if instead, no evt1-to-evt2 processing is required:<br>#ln -s ${event_root}.fits ${event_root}_new.fits<br>#-----------------------------------<br><br>#post evt2 processing:<br>ds9 ${event_root}_new.fits<br>#remove bright variable sources by placing them in a regional file source.reg<br>#currently only accept circle and ellipse regions.<br><br>$PUBDIR/cal_scripts/post_evt2.e ${event_root}_new <br>#drawback: the gti is read from the first gti extension and may not be the same for all chips<br>#check the lightcurve <br>set event_root=evt2file_new_clean<br>#============================================================================<br>#define the energy band:<br>$PUBDIR/cal_scripts/def_bands.e<br><br>#place the output from the above into the following:<br>#setenv BANDS "500:1000 1000:2000 2000:4000 4000:8000"<br>setenv BANDS "300:700 700:1500 1500:3000 3000:7000"<br>#setenv BANDS "1000:2500 2500:4000 4000:6000 6000:9000"<br><br>$PUBDIR/cal_scripts/make_expmap.e ${event_root} asol_file &amp;<br>mv _eventsfile_clean_gti.fits ${event_root}_new_clean_gti.fits <br>rm _* temp_* new_*<br>#----------------------------------<br>#for a target with many pointings. If extensive spectral extraction is going to be done<br>#with no-ciao program (e.g., multi_spec.pro), create the mask for calculating backscal:<br>$PUBDIR/cal_scripts/make_mask.e ${event_root} asol_file  <br>#INSTR and event_root need to be defined, if runs independently.<br>#----------------------------------<br>#move to the main directory<br>mkdir xdata<br>cd xdata<br>#for single file, use<br> $PUBDIR/cal_scripts/cal_mob_link.e ../ "./"<br><br>#in xdata, for multiple observations of a single targe<br>$PUBDIR/cal_scripts/cal_mob_link.e /d4/m82 "1302" evt2file <br><br>;for a subarray observation with only (ccd7 turned on), instead do:<br>set evtdir='../cal/'<br>ln -s ${evtdir}${event_root}_i300:700_ccd7.fits   ${event_root}_ccd7_i1.fits<br>ln -s ${evtdir}${event_root}_i700:1500_ccd7.fits  ${event_root}_ccd7_i2.fits<br>ln -s ${evtdir}${event_root}_i1500:3000_ccd7.fits ${event_root}_ccd7_i3.fits<br>ln -s ${evtdir}${event_root}_i3000:7000_ccd7.fits ${event_root}_ccd7_i4.fits<br><br>ln -s ${evtdir}${event_root}.fits   ${event_root}_ccd7.fits<br># end of the data calibration!!<br><br>#check the image if there is any bright source that may produce a CCD streak.<br>#If yes, proceed to remove the streak by reading memo_dstreak.<br>##########################################################################<br># Procedure for processing multiple observations:<br># do something SIMILAR to the following:<br>set oblist="1302 361 378 379 380_1 380_2"<br>$PUBDIR/cal_scripts/cal_mob.e "$oblist" &gt; cal_mob.log <br><br>./def_bands.e<br>#place the output from the above into the following:<br>setenv BANDS "500:1000 1000:2000 2000:4000 4000:8000"<br><br>$PUBDIR/cal_scripts/cal_mob_link.e "../" "${oblist}"  "evt2file_new_clean"<br>#which produce links (similar to the above) to the default file names in<br>#the directory xdata.<br>##########################################################################<br># Description of the above procedure<br>#<br>##Procedure:<br>#1) Compare the processing date and version of the data with the present CALDB<br># to see whether reprocessing evt2 is needed.<br>#<br>#2) Pre-calibration<br># 	Decompress files and appropriate soft links<br>#<br>#3) Calibration<br>#	optional evt1to2 processing <br>#	post-evt2 processing: remove extra destreak, <br>#		bad pixels, background flares<br>#<br>#4) Make exposure maps<br>#<br>#*Outputs:<br># ${event_root}_new_clean.fits - cleaned evt2 file<br># various exposure maps<br># average light curves of the observation<br>#====================================================</pre>
<br>
</body>
</html>
