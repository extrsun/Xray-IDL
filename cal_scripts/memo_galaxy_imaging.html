<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta content="text/html; charset=ISO-8859-1"
 http-equiv="content-type">
  <title>memo_cal.html</title>
  <meta content="Daniel Wang" name="author">
</head>
<body>
<pre>;Imaging analysis of Chandra data on galaxies<br>;=============================================================================<br>; written by wqd, May 29, 2003<br>;=============================================================================<br>; Part 1: csmoothed X-ray images (a modified version of memo_anal)<br>;=============================================================================<br>;basic setup<br>instr='aciss'                   ;change to the appropriate instrument<br>cenvset,instr<br>gradec=[167.879042,55.674111] ;Galaxy center position from Ms. Tara (or NED)<br>soufile='evt2file_new_clean_map70BSH_hr'<br>cd,'images' ;which may have been produced during the basic analysis<br>evtroot='evt2file_new_clean' <br>;-----------------------<br>;If the count (ca), background (ba), and exposure (ta) maps are yet to be <br>;produced. If nofits keyword is set, no fits files will be produced.<br>imdim=600      <br>maindir='../../' ;the relative dir location of the top level of the obs.<br>imccd=[6,7]<br>evt_image,evtroot,instr,ca,ta,ba=ba,datadir=maindir+'xdata/',hdr=mh,xmin=xmin,ymin=ymin,list=l,gradec=gradec,imdim=imdim,imccd=imccd<br>;,bfname='../../back/bevt2file_new_clean_ccd'+strtrim([6,7,8],2)+'.fits' ;/nofits<br>;The produced fits files can be adaptively smoothed with CIAO mcsmooth, <br>; following memo_analysis:<br>;------------------------<br>;In case that the background normalization is needed and differs from one chip to another:<br>;construct the background image chip by chip:<br><br>bnorm=[1.1868013,1.0181527,1.1962459] ;copied from running cal_background.pro (memo_bg)<br>ba=ta*0.<br>for k=0,n_elements(imccd)-1 do begin &amp; evt_image,evtroot,instr,ba=a,datadir=maindir+'xdata/',hdr=mh,xmin=xmin,ymin=ymin,gradec=gradec,imdim=imdim,bfname='../../xdata/bevt2file_new_clean.fits',/bmaponly,/nofits,imccd=imccd(k) &amp; ba=ba+a*bnorm(k) &amp; endfor<br>for k=0,3 do begin &amp; writefits,'b_'+strtrim(k+1,2)+'.fits',ba(*,*,k),mh<br><br>;Do a simple gaussian smoothed intensity image to see if the produced images are OK:<br>g5=psf_gaussian(fwhm=10,/norm,npix=121)<br>tv,bscale(convolve(total(imdiv(ca-ba,ta),3),g5)*1.e3,0,0.01)<br>;-----------------------<br>;in a separate window, run the ciao command in the same directory:<br>$PUBDIR/cal_scripts/mcsmooth.e "1 2 3 4" 2.5 3.5 1 &amp;<br>;------------------------<br>;Now read in the smoothed<br>t=readfits('t_4.fits')<br>;edge=[44+10,44+40] ;for removing the edges of the smoothed image and adjust accordingly for an individual target<br>read_mimages,4,mh,fs,a,mv,cor=cor,edge=edge,mdim=mdim,filter=t,bnorm=1 ;,/bfoff<br>;for 1+2,3, 4 bands<br>amv=-(mv(0))*0.85 ;such numerical values may be adjusted to reach a desirable contrast <br>a(*,*,0)=bscale(alog10(fs(*,*,0)+amv),alog10(mv(0)+amv),alog10((mv(0)+amv)*100))<br>amv=-mv(1)*0.85<br>a(*,*,1)=bscale(alog10(fs(*,*,1)+amv),alog10(mv(1)+amv),alog10((mv(1)+amv)*1000))<br>amv=-(mv(2)+mv(3))*0.85<br>a(*,*,2)=bscale(alog10(fs(*,*,2)+fs(*,*,3)+amv),alog10(mv(2)+mv(3)+amv),alog10((mv(2)+mv(3)+amv)*2000))<br>cont_grey,a,mh,cor=cor,true=3,mr=0,/ps,/nocon,/full,f_c=-1,barf=0. <br><br>;to raise the diffuse emission contrast by removing background constants for a better logrithmic scalling:<br>;for 1+2,3, 4 bands<br>amv=-(mv(0)+mv(1))*0.9 ;such numerical values may be adjusted to reach a desirable contrast <br>a(*,*,0)=bscale(alog10(fs(*,*,0)+fs(*,*,1)+amv),alog10(mv(0)+mv(1)+amv),alog10((mv(0)+mv(1)+amv)*80))<br>amv=-mv(2)*0.3<br>a(*,*,1)=bscale(alog10(fs(*,*,2)+amv),alog10(mv(2)+amv),alog10((mv(2)+amv)*20))<br>amv=-mv(3)*0.1<br>a(*,*,2)=bscale(alog10(fs(*,*,3)+amv),alog10(mv(3)+amv),alog10((mv(3)+amv)*5))<br>cont_grey,a,mh,cor=cor,true=3,mr=0,/ps,/nocon,/full,f_c=-1,barf=0.<br> ;----------------------------- <br>cast,'../../mdata/N3556C20NW.FITS',mh,outa=r<br>cont_grey,r,mh,a,cor=cor,true=3,mr=0,/ps,/full,f_c=-1,barf=0,lev=[1,2,3,4,6,10,15,30,50,100,200]*0.0002,c_c=255<br>scale='1''<br> scale_plot,cor,mh,0.08,0.94,1,scale,thick=2,char=cs,color=255<br> s=tvrd(0,0,true=3)<br>write_jpeg,'n3556_rgb_r.jpg',s,true=3,qua=100<br><br>f=total(fs(*,*,0:1),3)<br> cont_grey,r,mh,f,cor=cor,mr=0,/ps,/full,f_c=-1,barf=0.,greymin=2,greymax=100,greylo=1,lev=[1,2,3,4,6,10,15,30,50,100,200]*0.0002,c_c=255<br>;----------------------------- <br>cast,'../../mdata/dss2_blue.fits',mh,outa=o<br>cont_grey,f,mh,o,cor=cor,mr=0,/ps,/full,f_c=-1,barf=0.,greymin=1.e4,greymax=5e4,greylo=2,lev=[1,2,3,4,6,10,15,25,50,100]*0.2+2.6,c_c=255<br>;----------------------------<br>device,bits=8,/land,color=1,xsize=16.*mdim(0)/mdim(1),ysiz=16,yoff=26,xoff=2 <br><br>fh=total(fs(*,*,2:3),3)<br>cont_grey,fh,mh,cor=cor,mr=0,/ps,/full,f_c=-1,barf=0.,greymin=1.e4,greymax=5e4,greylo=2,lev=[1,2,3,4,6,10,15,25,50,100]*1+3.5,c_c=255,/noim<br>fb=total(fs,3)<br>cont_grey,fb,mh,cor=cor,mr=0,/ps,/full,f_c=-1,barf=0.,greymin=1.e4,greymax=5e4,greylo=2,lev=[1,2,3,4,6,10,15,25,50,100]*2+6,c_c=255,/noim<br><br>source_plot,soufile,cor,mh,/fits,probth=probth,psym=6,sym=2<br>source_plot,soufile,cor,mh,/fits,probth=probth,psym=6,sym=1,/sou</pre>
</body>
</html>
