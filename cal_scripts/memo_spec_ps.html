<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta content="text/html; charset=ISO-8859-1"
 http-equiv="content-type">
  <title>memo_cal.html</title>
  <meta content="Daniel Wang" name="author">
</head>
<body>
<pre>;=========================================================================<br>#Requirements:<br># 1)  ciao and ftools are runnig<br># 2)  move to a directory called spec_ps under MAINDIR or a subdirectory <br># 	furhter down (one source per directory may be a good idea).<br>#<br># written by wqd, June 6, 2003<br><br>!!!!This memo probably needs to be updated to use specextract:<br><br>specextract "acis_evt2.fits[sky=region(1447_src.reg)]"<br>pbkfile=acisf063875928N002_pbk0.fits dafile=CALDB outroot=acis_1447<br>bkgfile="acis_evt2.fits[sky=region(1447_bkg.reg)]" grouptype=NUM_CTS<br>binspec=10 bkg_grouptype=NUM_CTS bkg_binspec=10<br><br>Tnew script, which is written in S-Lang ("ahelp <br>    slang"), is also able to accept a stack of input files in order to<br>    generate many spectra from one command.  Note that specextract<br>    does *not* offer the option to coadd spectra as acisspec does.<br><br>;=========================================================================<br>#first set up ardlib to use the bad pixel file for your observation<br>acis_set_ardlib ../cal/bpixfile.fits<br>plist ardlib | more<br><br>#define the input event and output spectrum file root names:<br>set event_root=evt2file_new_clean<br>set spec_root=ds9<br><br>set MAINDIR=/d1/n3556<br><br>#event 2 file location:<br>set datadir=$MAINDIR/xdata<br><br>#source removed event 2 file location (from diffuse study; see memo_spec_d):<br>set datadir_sd=$MAINDIR/spec<br><br>set eventfile=${datadir}/${event_root}.fits<br>set eventfile_sd=${datadir_sd}/${event_root}_sd.fits<br>$PUBDIR/cal_scripts/assign_bpix.e $MAINDIR/cal/bpixfile.fits<br><br>set reg_s=${spec_root}.reg<br>set reg_b=${spec_root}_b.reg<br><br>#use ds9 to create a region file (def: ${spec_root}.reg) to define the source<br># and a background region (def: ${spec_root}_b.reg); saved in the ciao format.<br># The backg region (e.g., an annulus) should be large enough to contain<br># meaningful number of counts. It is OK to include regions with source <br># removed. psextract seems to correct the area removed automatically.<br>ds9  $eventfile_sd &amp;<br><br>#find where the aoff file is:; no longer used<br>#find $MAINDIR -name 'pcad*asol*' -print<br>#If the output is a single file; no longer used<br>#find $MAINDIR -name 'pcad*asol*' -exec ln -s {} asolfile \;<br>#psextract demands a different name for asolfile, if events differs bgevents<br><br>ln -s ../cal/asol_file asol_file<br>ln -s asol_file basol_file<br><br>#the following seems to have some problem on gcs (library problem?)<br>punlearn psextract<br>pset psextract events="${eventfile}[sky=region($reg_s)]"<br>pset psextract bgevents="${eventfile_sd}[sky=region($reg_b)]"<br>pset psextract root=${spec_root}<br>pset psextract asol=@asol_file<br>pset psextract bgasol=@basol_file<br>pset psextract gtype=NUM_CTS<br>pset psextract gspec=15<br>pset psextract clobber=yes<br>pset psextract mode=h<br>psextract verbose=2<br>#-------------------------------------<br>#Using the new mkacisrmf to make a more consistent and accurate (10-15% improvement) to generate rmf:<br>#(CIAO 3.2 acis_process_events uses the gain file that is consistent with mkacisrmf!)<br><br>set gfile = `dmkeypar ${eventfile} gainfile echo+`<br>#Modify the output from psextract and run:<br>mkacisrmf infile=$CALDB/data/chandra/acis/cpf/p2_resp/acisD2000-01-29p2_respN0002.fits \<br>      outfile=ds9.rmf wmap=none energy=0.1:11.0:0.01 channel=1:1024:1 chantype=pi \<br>      ccd_id=7 chipx=176 chipy=240 gain=$gfile<br><br>#there is a grid size difference between arf and rmf files. The workaround is to generate (or regenerate) arf later:<br><br>mkarf detsubsys=ACIS-S3 outfile=ds9.arf asphistfile="ds9.asphist" sourcepixelx=4037.4856391 sourcepixely=4088.7686774 grating=NONE obsfile="ds9.asphist" maskfile=NONE engrid="grid(ds9.rmf[MATRIX][cols ENERG_LO,ENERG_HI])" clobber=yes<br>#-----------------------------------<br>#http://cxc.harvard.edu/ciao/threads/apply_acisabs/ ;no longer used 4/20/04<br>#correct for the ACIS sensitivity degration:<br>#ln -s /net1/hobby/software/ciao_3.0.2/contrib/bin/interpreted/acisabs.sl apply_acisabs<br>#mv ${spec_root}.arf ${spec_root}_pre_abs.arf<br>#apply_acisabs ${spec_root}_pre_abs.arf ${spec_root}.arf<br>#===================================================================<br>grppha ${spec_root}.pi ${spec_root}_g.pi<br>reset group<br>group min 25<br>exit<br><br>#===================================================================<br>#spectral fits:<br>xspec<br>data ds9_g.pi<br>setplot e<br>ig bad <br>ig **-0.3 8.-**<br>cpd /xw<br>mo po wa<br><br>fit 20 0.05<br>plot ld <br><br>iplot<br>la f<br>la t<br>time off<br>lw 3<br>plot<br>hard<br><br>#===================================================================</pre>
</body>
</html>
